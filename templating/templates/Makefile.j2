CC = gcc
CFLAGS = -Wall -O2
CFLAGSUNOPT = -Wall -O0
CFLAGS+ = -g -Wall -O2
CYFLAGS = -Os -I /usr/include/python2.7
LDFLAGS = -levent -lhiredis -lrt -pthread -lsqlite3 -lasound
LDTESTFLAGS = -lsqlite3 -pthread
CYLDFLAGS = -lpython2.7 -lpthread -lm -lutil -ldl -lrt

all: timer {% for c in children %}{{c}} {% endfor %}network logger

debug: timer_debug server_debug

logger: logger.c sqlHelpers.c shmHelpers.c networkUtilities.c utilityFunctions.c sqlite3async.c
	$(CC) $(CFLAGS) logger.c sqlHelpers.c shmHelpers.c networkUtilities.c utilityFunctions.c sqlite3async.c -o logger $(LDFLAGS)

network: network.c utilityFunctions.c networkUtilities.c
	$(CC) $(CFLAGS) network.c utilityFunctions.c networkUtilities.c -o network $(LDFLAGS)

server_debug: network.c utilityFunctions.c networkUtilities.c
	$(CC) $(CFLAGS+) network.c utilityFunctions.c networkUtilities.c -o network $(LDFLAGS)

client: udpClient.c
	$(CC) $(CFLAGS) udpClient.c -o udpClient
{% for child in children %}
{{child}}: {{child}}.pyx networkUtilities.c utilityFunctions.c
	cython --embed -o {{child}}.c {{child}}.pyx
	$(CC) $(CYFLAGS) {{child}}.c networkUtilities.c utilityFunctions.c -o {{child}} $(CYLDFLAGS)
{% endfor %}
timer: timer.c utilityFunctions.c 
	$(CC) $(CFLAGS) timer.c utilityFunctions.c -o timer $(LDFLAGS)
 
timer_debug: timer.c utilityFunctions.c
	$(CC) $(CFLAGS+) timer.c utilityFunctions.c -o timer $(LDFLAGS)
	
clean:
	rm -f timer cyBurn network logger SQLite3Test audioInterface

test:
	$(CC) $(CFLAGS+) SQLite3Test.c -o SQLite3Test $(LDTESTFLAGS)
sound:
	$(CC) $(CFLAGS) audioInterface.c utilityFunctions.c -o audioInterface $(LDFLAGS) -lzmq -lflatcc
